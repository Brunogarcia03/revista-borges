---
import Layout from "../layouts/Layout.astro";

const trustedBy = [
  "LaSerenisima",
  "YPF",
  "Globant",
  "Mercado Libre",
  "Quilmes",
];

const press = ["La Nación", "Infobae", "Clarin", "Perfil"];

const services = [
  "Ensayo",
  "Investigación cultural",
  "Narrativas digitales",
  "Dirección editorial",
];

const contact = [
  { label: "Email", value: "revistaparrhesia@gmail.com" },
  { label: "Instagram", value: "Instagram" },
  { label: "Youtube", value: "Youtube" },
];
---

<Layout themeHeader={true}>
  <main
    class="clients relative flex flex-col w-full min-h-dvh overflow-hidden isolate bg-white pt-20 pb-5 sm:py-20"
  >
    <!-- Texto principal -->
    <section class="mx-3 sm:mx-5 space-y-4 z-20">
      <p
        class="split text-lg sm:text-xl md:text-2xl leading-5 md:leading-7 font-bold max-w-5xl text-pretty z-20"
      >
        1. Somos una publicación independiente que entiende la libre expresión
        como un bien fundamental. Defendemos la palabra, la imagen y la idea
        como territorios donde el pensamiento crítico no solo es posible, sino
        necesario. Nuestro trabajo nace de la observación, la duda y el
        conflicto con lo establecido.
      </p>

      <p
        class="split text-lg sm:text-xl md:text-2xl leading-5 md:leading-7 font-bold max-w-5xl text-pretty z-20"
      >
        2. Abordamos Literatura, Arte, Política, Historia y Sociedad desde una
        mirada editorial que cuestiona, conecta y propone. Cada edición, cada
        pieza y cada colaboración busca abrir conversaciones, tal vez incomodar
        pero, sobre todo: expandir el lenguaje con el que interpretamos el
        presente.
      </p>
    </section>

    <div
      class="clients-preview fixed top-1/2 -translate-1/2 left-1/2 w-[90%] h-[60%] sm:w-[80%] sm:h-[50%] md:w-[70%] md:h-[55%] lg:w-[65%] lg:h-[75%] z-0 pointer-events-none"
    >
    </div>

    <!-- Footer -->
    <footer
      class="flex flex-col gap-y-10 md:flex-row justify-between mx-3 sm:mx-5 pt-6 md:pt-12 mt-auto z-20"
    >
      <div
        class="grid grid-cols-1 sm:grid-cols-2 gap-3 md:gap-6 max-w-5xl w-full"
      >
        <!-- Confían -->
        <article class="max-w-xs appearance">
          <span class="text-neutral-700 uppercase font-heading text-base">
            Confían en nosotros
          </span>
          <ul class="mt-1 text-base leading-relaxed clients-list">
            {
              trustedBy.map((item, i) => (
                <li class="client-name text-pretty inline">
                  <span class="text-nowrap relative after:absolute after:bottom-0 after:left-0 after:h-0.5 after:w-full after:origin-bottom-left after:scale-x-100 after:bg-neutral-800 after:transition-transform after:duration-150 after:ease-in-out hover:after:origin-bottom-right hover:after:scale-x-0 mr-1.5 cursor-pointer">
                    {`${item}${i < trustedBy.length - 1 ? "," : "."}`}
                  </span>
                </li>
              ))
            }
          </ul>
        </article>
        <!-- Prensa -->
        <article class="appearance">
          <span class="text-neutral-600 uppercase font-heading text-base">
            Prensa
          </span>
          <ul class="mt-1 text-base leading-relaxed">
            {
              press.map((item, i) => (
                <li class="inline cursor-pointer mr-1.5 hover:text-amber-300 transition-colors duration-300">
                  {`${item}${i < press.length - 1 ? "," : "."}`}
                </li>
              ))
            }
          </ul>
        </article>

        <!-- Servicios -->
        <article class="appearance">
          <span class="text-neutral-700 uppercase font-heading text-base">
            Servicios
          </span>
          <ul class="mt-1 text-base leading-relaxed text-balance">
            {
              services.map((item, i) => (
                <li class="service-name inline mr-1.5 relative after:absolute after:bottom-0 after:left-0 after:h-px after:bg-black after:w-full after:origin-bottom-right after:scale-x-0 after:transition-transform after:duration-300 after:ease-[cubic-bezier(0.65_0.05_0.36_1)] hover:after:origin-bottom-left hover:after:scale-x-100 cursor-pointer">
                  <span class="whitespace-nowrap">
                    {`${item}${i < services.length - 1 ? "," : "."}`}
                  </span>
                </li>
              ))
            }
          </ul>
        </article>

        <!-- Contacto -->
        <article class="appearance max-w-sm">
          <span class="text-neutral-700 uppercase font-heading text-base">
            Contacto
          </span>
          <ul class="mt-1 text-base leading-relaxed cursor-pointer">
            {
              contact.map((item) => (
                <li class="hover:text-amber-300 transition-colors duration-300">
                  {item.value}
                </li>
              ))
            }
          </ul>
        </article>
      </div>

      <!-- Call to action -->
      <div
        class="flex flex-col items-center md:items-end justify-between w-full min-h-full lg:mr-12"
      >
        <div
          class="md:hidden w-full border-t-2 border-dashed border-black mt-4 md:mt-7"
        >
        </div>
        <h3
          class="split mt-4 md:mt-0 text-3xl md:text-4xl lg:text-5xl text-center md:text-end text-balance max-w-none md:max-w-md font-bold font-heading uppercase"
          style="filter: url(#threshold)"
        >
          Pensar el presente. Publicar sin concesiones.
        </h3>
        <a
          id="colabs"
          href="mailto:brunogalberti@gmail.com"
          class="appearance flex justify-end text-center w-full max-w-md md:max-w-md group mt-4 md:mt-auto cursor-pointer"
          ><span
            class="w-full max-w-md md:max-w-lg py-2 rounded-[.2rem] bg-black group-hover:bg-transparent border border-transparent group-hover:border-dashed group-hover:border-black group-hover:text-black transition-colors duration-300 text-white"
            >Proponer una colaboración</span
          ></a
        >
      </div>
    </footer>
    <svg class="absolute w-0 h-0">
      <defs>
        <filter id="threshold">
          <feColorMatrix
            in="SourceGraphic"
            type="matrix"
            values=" 1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 255 -140 "
          ></feColorMatrix>
        </filter>
      </defs>
    </svg>
  </main>
</Layout>

<script>
  import gsap from "gsap";
  import SplitText from "gsap/SplitText";

  import img1 from "../assets/simulations/img1.webp";
  import img2 from "../assets/simulations/img2.webp";
  import img3 from "../assets/simulations/img3.webp";
  import img4 from "../assets/simulations/img4.webp";
  import img5 from "../assets/simulations/img5.webp";

  import services1 from "../assets/photos/services1.webp";
  import services2 from "../assets/photos/services2.webp";
  import services3 from "../assets/photos/services3.webp";
  import services4 from "../assets/photos/services4.webp";

  gsap.registerPlugin(SplitText);

  const trustedImgs = [img1.src, img5.src, img2.src, img3.src, img4.src];

  const servicesImgs = [
    services1.src,
    services2.src,
    services3.src,
    services4.src,
  ];

  let activeIndex = -1;
  let activeWrapper: any = null;
  let activeImg: any = null;

  function preloadImages(urls: string[]) {
    urls.forEach((src) => {
      const img = new Image();
      img.src = src;
    });
  }

  function clearActiveImage() {
    if (!activeImg || !activeWrapper) return;

    const img = activeImg;
    const wrapper = activeWrapper;

    activeImg = null;
    activeWrapper = null;
    activeIndex = -1;

    gsap.to(img, {
      opacity: 0,
      duration: 0.8,
      ease: "power1.out",
      onComplete: () => wrapper.remove(),
    });
  }

  function initHoverImages(selector: any, images: any) {
    const items = document.querySelectorAll(selector);
    const preview = document.querySelector(".clients-preview");

    if (!items.length || !preview) return;

    items.forEach((item, index) => {
      item.addEventListener("mouseenter", () => {
        if (!images[index]) return;
        if (activeIndex === index) return;

        clearActiveImage();
        activeIndex = index;

        const wrapper = document.createElement("div");
        wrapper.className = "client-img-wrapper";

        const img = document.createElement("img");
        img.src = images[index];

        gsap.set(img, { scale: 1.25, opacity: 0 });

        wrapper.appendChild(img);
        preview.appendChild(wrapper);

        activeWrapper = wrapper;
        activeImg = img;

        gsap.to(wrapper, {
          clipPath: "polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%)",
          duration: 0.8,
          ease: "power3.inOut",
        });

        gsap.to(img, {
          opacity: 1,
          scale: 1,
          duration: 1.2,
          ease: "power3.out",
        });
      });

      item.addEventListener("mouseleave", clearActiveImage);
    });
  }

  function initPageAnimations() {
    preloadImages(trustedImgs);
    preloadImages(servicesImgs);

    initHoverImages(".client-name", trustedImgs);
    initHoverImages(".service-name", servicesImgs);

    document.fonts.ready.then(() => {
      gsap.set(".split", { opacity: 1 });

      SplitText.create(".split", {
        type: "lines",
        autoSplit: true,
        mask: "lines",
        onSplit: (self) =>
          gsap.from(self.lines, {
            yPercent: 100,
            opacity: 0,
            stagger: 0.1,
            duration: 0.6,
            ease: "expo.out",
          }),
      });

      gsap.from(".appearance", {
        scale: 0.5,
        opacity: 0,
        duration: 0.8,
        stagger: 0.1,
        ease: "expo.out",
      });
    });
  }

  function cleanupPage() {
    clearActiveImage();
  }

  document.addEventListener("astro:page-load", initPageAnimations);
  document.addEventListener("astro:before-swap", cleanupPage);
</script>
